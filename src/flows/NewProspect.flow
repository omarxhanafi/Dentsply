<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>EmailToOpportunityOwner</name>
        <label>EmailToOpportunityOwner</label>
        <locationX>237</locationX>
        <locationY>563</locationY>
        <actionName>Opportunity.Global_Xsbu_Opportunity_Owner_information</actionName>
        <actionType>emailAlert</actionType>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>Opp2Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <apiVersion>49.0</apiVersion>
    <constants>
        <name>True</name>
        <dataType>String</dataType>
        <value>
            <stringValue>True</stringValue>
        </value>
    </constants>
    <decisions>
        <name>FoundMatch</name>
        <label>FoundMatch</label>
        <locationX>241</locationX>
        <locationY>307</locationY>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>Matched</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>SironaRep</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>UpdateOpp</targetReference>
            </connector>
            <label>Matched</label>
        </rules>
        <rules>
            <name>KeepLooping</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>SironaRep</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AccountShareLoop</targetReference>
            </connector>
            <label>KeepLooping</label>
        </rules>
    </decisions>
    <description>added the email to the opportunity owner and to the default owner
-&gt;previous working version number 18. Now I added PREP in &quot;WhichSBU&quot; formula.</description>
    <formulas>
        <name>WhichSBU</name>
        <dataType>String</dataType>
        <expression>CASE ( Text({!InterestedProdInfo.Product_Line_Interested_In__c}),&quot;CAD/CAM&quot;,&quot;Sales Rep (CDCM)&quot;,&quot;Imaging&quot;,&quot;Sales Rep (IMAG)&quot;,&quot;Imaging - Intra Oral&quot;,&quot;Sales Rep (IMAG)&quot;,&quot;Imaging - Extra Oral&quot;,&quot;Sales Rep (IMAG)&quot;,&quot;Treatment Centers&quot;,&quot;Sales Rep (TRCE)&quot;,&quot;Implants&quot;,&quot;Sales Rep (IMPL)&quot;,&quot;PREP&quot;,&quot;Sales Rep (PREP)&quot;,&quot;CAD/CAM - Nazar√©&quot;,&quot;Sales Rep (CDCM)&quot;,&quot;Default&quot;)</expression>
    </formulas>
    <interviewLabel>NewProspect {!$Flow.CurrentDateTime}</interviewLabel>
    <label>NewProspect</label>
    <loops>
        <name>AccountShareLoop</name>
        <label>AccountShareLoop</label>
        <locationX>508</locationX>
        <locationY>308</locationY>
        <assignNextValueToReference>VarAccountShare</assignNextValueToReference>
        <collectionReference>AccountShare</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>PickGroup</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>NoSironaRep</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>AccountInfo</name>
        <label>AccountInfo</label>
        <locationX>738</locationX>
        <locationY>458</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AccountShareLookup</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Acc2Id</elementReference>
            </value>
        </filters>
        <object>Account</object>
        <outputReference>AccountDetails</outputReference>
        <queriedFields>Name</queriedFields>
        <queriedFields>RecordTypeId</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>AccountShareLookup</name>
        <label>AccountShare</label>
        <locationX>741</locationX>
        <locationY>308</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AccountShareLoop</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AccountId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Acc2Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>RowCause</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Territory</stringValue>
            </value>
        </filters>
        <object>AccountShare</object>
        <outputReference>AccountShare</outputReference>
        <queriedFields>AccountId</queriedFields>
        <queriedFields>UserOrGroupId</queriedFields>
        <queriedFields>Id</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>InterestedProd</name>
        <label>InterestedProd</label>
        <locationX>41</locationX>
        <locationY>34</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>UserTerritory2Association</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Opp2Id</elementReference>
            </value>
        </filters>
        <object>Opportunity</object>
        <outputReference>InterestedProdInfo</outputReference>
        <queriedFields>Product_Line_Interested_In__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>PickGroup</name>
        <label>PickGroup</label>
        <locationX>509</locationX>
        <locationY>35</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>PickTerritory</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>VarAccountShare.UserOrGroupId</elementReference>
            </value>
        </filters>
        <object>Group</object>
        <outputReference>GroupId</outputReference>
        <queriedFields>RelatedId</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>PickTerritory</name>
        <label>PickTerritory</label>
        <locationX>240</locationX>
        <locationY>33</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>InterestedProd</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>GroupId.RelatedId</elementReference>
            </value>
        </filters>
        <object>Territory2</object>
        <outputReference>VarTerritory2</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Territory2ModelId</queriedFields>
        <queriedFields>Name</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>UserTerritory2Association</name>
        <label>UserTerritory2Association</label>
        <locationX>242</locationX>
        <locationY>179</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>FoundMatch</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>RoleInTerritory2</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WhichSBU</elementReference>
            </value>
        </filters>
        <filters>
            <field>Territory2Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>VarTerritory2.Id</elementReference>
            </value>
        </filters>
        <object>UserTerritory2Association</object>
        <outputReference>SironaRep</outputReference>
        <queriedFields>UserId</queriedFields>
        <queriedFields>Id</queriedFields>
        <queriedFields>RoleInTerritory2</queriedFields>
        <queriedFields>Territory2Id</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>NoSironaRep</name>
        <label>NoSironaRep</label>
        <locationX>508</locationX>
        <locationY>455</locationY>
        <connector>
            <targetReference>EmailToOpportunityOwner</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Opp2Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>DefaultUser</elementReference>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordUpdates>
    <recordUpdates>
        <name>UpdateOpp</name>
        <label>UpdateOpp</label>
        <locationX>240</locationX>
        <locationY>454</locationY>
        <connector>
            <targetReference>EmailToOpportunityOwner</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Opp2Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>SironaRep.UserId</elementReference>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordUpdates>
    <startElementReference>AccountInfo</startElementReference>
    <status>Active</status>
    <variables>
        <name>Acc2Id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>AccountDetails</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Account</objectType>
    </variables>
    <variables>
        <name>AccountShare</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>AccountShare</objectType>
    </variables>
    <variables>
        <name>AssignedUserId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>DefaultUser</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>GroupId</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Group</objectType>
    </variables>
    <variables>
        <name>InterestedProdInfo</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>Opp2Id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>RepInfo</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>User</objectType>
    </variables>
    <variables>
        <name>SironaRep</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>UserTerritory2Association</objectType>
    </variables>
    <variables>
        <name>User2Id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>VarAccountShare</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>AccountShare</objectType>
    </variables>
    <variables>
        <name>VarTerritory2</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Territory2</objectType>
    </variables>
    <variables>
        <name>VarUserData</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>User</objectType>
    </variables>
</Flow>
