<!--	
Author: 		Richard Trum (Glimt) 2019-11-27 	
Description:   	Component to mass edit Product Profiling records - embedded in component ProductProfilingComponent
-->

<aura:component controller="ProductProfilingHierarchyController" implements="lightning:availableForFlowScreens" access="global" >
		<aura:handler name="init" value="{!this}" action="{!c.init}" />
    	<aura:registerEvent name="cmpEvent" type="c:deletedProductProfiling"/>
      	<aura:attribute name="selectedProducts" type="Product_Profiling__c[]" />
    	<aura:attribute name="columns" type="List"/>
    	<aura:attribute name="showSpinner" type="boolean" default="false"/>
    	<aura:attribute name="options" type="List" default="[
    		{'label': 'Prospect', 'value': 'Prospect'},
    		{'label': 'Low Usage', 'value': 'Low Usage'},
    		{'label': 'Medium Usage', 'value': 'Medium Usage'},
            {'label': 'High Usage', 'value': 'High Usage'}, 
          	{'label': 'Installed', 'value': 'Installed'}, 
          	{'label': 'Not Interested', 'value': 'Not Interested'},                                                             
    	]"/>
    	<aura:attribute name="productsLoaded" type="Map" default="{}" />
		<aura:attribute name="yearOptions" type="List" />

    	<aura:if isTrue="{!v.showSpinner}">
    		<lightning:spinner variant="brand" size="small" alternativeText="Updating" />
    	</aura:if>


    	<div style="height: 400px;">
    	<div class="slds-scrollable--y" style="height: 100%;">

			<table class="slds-table slds-table_bordered slds-table_cell-buffer">
				<thead>
				<tr>
					<th style="width: 20%; height: 40px;">Product</th>
					<th style="width: 20%; height: 40px;">Product Family</th>
					<th style="width: 15%; height: 40px;">Contact</th>
					<th style="width: 15%; height: 40px;">Quantity</th>
					<th style="width: 15%; height: 40px;" class="slds-line-height_reset slds-text-align_left">
						<div class="slds-grid slds-grid_vertical-align-center">
							<span>In Use Since?</span>
							<div class="slds-p-left_x-small">
								<lightning:helptext content="Year of installation/first usage" iconName="utility:info" />
							</div>
						</div>
					</th>
					<th style="width: 10%; height: 40px;"></th>
					<th style="width: 5%; height: 40px;">Action</th>
				</tr>
				</thead>
				<tbody>
				<aura:iteration items="{!v.selectedProducts}" var="item" indexVar="Id">
					<tr>
						<td>
							<lightning:input name="productName" readonly="true" value="{!item.Product_Name__r.Name}"/>
						</td>
						<td>
							<lightning:input readonly="true" value="{!item.Product_Name__r.ProductFamily__r.ProductFamilyLabel__c}"/>
						</td>
						<td>
							<lightning:recordEditForm objectApiName="Product_Profiling__c" recordId="{!item.Id}">
								<lightning:inputField fieldName="Contact__c" value="{!item.Contact__c}" />
							</lightning:recordEditForm>
						</td>
						<td>
							<lightning:input type="number" name="quantity" value="{!item.Quantity__c}"/>
						</td>
						<td>
							<lightning:combobox
												name="inUseSince"
												value="{!item.InUseSince__c}" options="{!v.yearOptions}"/>
						</td>
						<td>
							<lightning:input type="checkbox" name="inactive" label="Inactive?" checked="{!item.Inactive__c}"/>
						</td>
						<td>
							<lightning:buttonIcon name="{!item.Id}" size="large" iconName="utility:delete" variant="bare" alternativeText="Delete" title="Delete" onclick="{!c.deleteProduct}" />
						</td>
					</tr>
				</aura:iteration>
				</tbody>
			</table>

		</div>
    	{!v.deleteButton}
    	<div class="slds-m-top_medium slds-float--right sticky-button_bottom-container">
            <!--<footer class="slds-modal__footer"> -->
            	<lightning:button variant="brand" type="submit" name="save" label="Save" onclick="{!c.setValues}"/>
        	<!--</footer> -->
       	</div>
    </div>
</aura:component>