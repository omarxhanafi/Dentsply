


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: DC_ICalendarContentBuilder</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">default.classes</a> ]
</div>

<h1>Coverage Summary for Class: DC_ICalendarContentBuilder (default.classes)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">DC_ICalendarContentBuilder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 137)
  </span>
</td>
</tr>

</table>

<br/>
<br/>

<h2>DC_ICalendarContentBuilder</h2>
<div class="sourceCode"><i>1</i>&nbsp;//
<i>2</i>&nbsp;//This class is a content builder for an ICS-file.
<i>3</i>&nbsp;//
<i>4</i>&nbsp;//Author: Gennadiy Pervukhin (5-11-2014)
<i>5</i>&nbsp;public class DC_ICalendarContentBuilder
<i>6</i>&nbsp;{
<i>7</i>&nbsp;	//
<i>8</i>&nbsp;	//Constructors
<i>9</i>&nbsp;	//
<b class="nc"><i>10</i>&nbsp;	public DC_ICalendarContentBuilder()</b>
<i>11</i>&nbsp;	{
<b class="nc"><i>12</i>&nbsp;		this.isAllDayEvent = false;</b>
<b class="nc"><i>13</i>&nbsp;		this.attendees = new List&lt;Participant&gt;();</b>
<i>14</i>&nbsp;	}
<i>15</i>&nbsp;	//
<i>16</i>&nbsp;	
<i>17</i>&nbsp;	//
<i>18</i>&nbsp;	//Constants
<i>19</i>&nbsp;	//
<b class="nc"><i>20</i>&nbsp;	private static final String SEPARATOR_OF_CONTENT_LINES = &#39;\n&#39;;</b>
<b class="nc"><i>21</i>&nbsp;	private static final String SEPARATOR_OF_ATTRIBUTES = &#39;;&#39;;</b>
<b class="nc"><i>22</i>&nbsp;	private static final String SEPARATOR_OF_ATTRIBUTE_VALUES = &#39;,&#39;;</b>
<i>23</i>&nbsp;	
<b class="nc"><i>24</i>&nbsp;	private static final String UNKNOWN_EMAIL = &#39;unknown_email&#39;;</b>
<i>25</i>&nbsp;	
<b class="nc"><i>26</i>&nbsp;	private static final String DATETIME_FORMAT = &#39;yyyyMMdd\&#39;T\&#39;HHmmss\&#39;Z\&#39;&#39;;</b>
<b class="nc"><i>27</i>&nbsp;	private static final String DATE_FORMAT = &#39;yyyyMMdd&#39;;</b>
<i>28</i>&nbsp;	
<b class="nc"><i>29</i>&nbsp;	private static final String REQUEST_METHOD = &#39;REQUEST&#39;;</b>
<b class="nc"><i>30</i>&nbsp;	private static final String CANCEL_METHOD = &#39;CANCEL&#39;;</b>
<i>31</i>&nbsp;	
<b class="nc"><i>32</i>&nbsp;	private static final String VERSION = &#39;2.0&#39;;</b>
<b class="nc"><i>33</i>&nbsp;	private static final String PRODUCT_ID = &#39;-//salesforce.com/Custom_Event_Notifier//EN&#39;;</b>
<b class="nc"><i>34</i>&nbsp;	private static final String DEFAULT_TRANSPARENCY = &#39;OPAQUE&#39;;</b>
<b class="nc"><i>35</i>&nbsp;	private static final String DEFAULT_SEQUENCE = &#39;0&#39;;</b>
<b class="nc"><i>36</i>&nbsp;	private static final String DEFAULT_CLASS = &#39;PUBLIC&#39;;</b>
<b class="nc"><i>37</i>&nbsp;	private static final String DEFAULT_PRIORITY = &#39;5&#39;;</b>
<i>38</i>&nbsp;	
<b class="nc"><i>39</i>&nbsp;	public static final String STATUS_CONFIRMED = &#39;CONFIRMED&#39;;</b>
<b class="nc"><i>40</i>&nbsp;	public static final String STATUS_TENTATIVE = &#39;TENTATIVE&#39;;</b>
<b class="nc"><i>41</i>&nbsp;	public static final String STATUS_CANCELLED = &#39;CANCELLED&#39;;</b>
<i>42</i>&nbsp;	
<b class="nc"><i>43</i>&nbsp;	public static final String FREQUENCY_DAILY = &#39;DAILY&#39;;</b>
<b class="nc"><i>44</i>&nbsp;	public static final String FREQUENCY_WEEKLY = &#39;WEEKLY&#39;;</b>
<b class="nc"><i>45</i>&nbsp;	public static final String FREQUENCY_MONTHLY = &#39;MONTHLY&#39;;</b>
<b class="nc"><i>46</i>&nbsp;	public static final String FREQUENCY_YEARLY = &#39;YEARLY&#39;;</b>
<i>47</i>&nbsp;	
<b class="nc"><i>48</i>&nbsp;	public static final String WEEK_DAY_SUNDAY = &#39;SU&#39;;</b>
<b class="nc"><i>49</i>&nbsp;	public static final String WEEK_DAY_MONDAY = &#39;MO&#39;;</b>
<b class="nc"><i>50</i>&nbsp;	public static final String WEEK_DAY_TUESDAY = &#39;TU&#39;;</b>
<b class="nc"><i>51</i>&nbsp;	public static final String WEEK_DAY_WEDNESDAY = &#39;WE&#39;;</b>
<b class="nc"><i>52</i>&nbsp;	public static final String WEEK_DAY_THURSDAY = &#39;TH&#39;;</b>
<b class="nc"><i>53</i>&nbsp;	public static final String WEEK_DAY_FRIDAY = &#39;FR&#39;;</b>
<b class="nc"><i>54</i>&nbsp;	public static final String WEEK_DAY_SATURDAY = &#39;SA&#39;;</b>
<i>55</i>&nbsp;	//
<i>56</i>&nbsp;	
<i>57</i>&nbsp;	//
<i>58</i>&nbsp;	//Private variables
<i>59</i>&nbsp;	//
<i>60</i>&nbsp;	private String status;
<i>61</i>&nbsp;	private String method;
<i>62</i>&nbsp;	//
<i>63</i>&nbsp;	
<i>64</i>&nbsp;	//
<i>65</i>&nbsp;	//Public variables
<i>66</i>&nbsp;	//
<i>67</i>&nbsp;	public Boolean isAllDayEvent;
<i>68</i>&nbsp;	public DateTime startDateTime;
<i>69</i>&nbsp;	public DateTime endDateTime;
<i>70</i>&nbsp;	
<i>71</i>&nbsp;	public Participant organizer;
<i>72</i>&nbsp;	public String uId;
<i>73</i>&nbsp;	public String location;
<i>74</i>&nbsp;	public String summary;
<i>75</i>&nbsp;	public String description;
<i>76</i>&nbsp;	public String htmlDescription;
<i>77</i>&nbsp;	
<i>78</i>&nbsp;	public RecurrenceRule recurrentRule;
<i>79</i>&nbsp;	public Alarm eventAlarm;
<i>80</i>&nbsp;	//
<i>81</i>&nbsp;	
<i>82</i>&nbsp;	//
<i>83</i>&nbsp;	//Properties
<i>84</i>&nbsp;	//
<b class="nc"><i>85</i>&nbsp;	public List&lt;Participant&gt; attendees {get; private set;}</b>
<i>86</i>&nbsp;	//
<i>87</i>&nbsp;	
<i>88</i>&nbsp;	//
<i>89</i>&nbsp;	//Private static methods
<i>90</i>&nbsp;	//
<b class="nc"><i>91</i>&nbsp;	private static void addNonBlankContentLine(List&lt;String&gt; contentLines,</b>
<i>92</i>&nbsp;		String propertyName, String propertyValue)
<i>93</i>&nbsp;	{
<b class="nc"><i>94</i>&nbsp;		if (String.isNotBlank(propertyValue))</b>
<i>95</i>&nbsp;		{
<b class="nc"><i>96</i>&nbsp;			contentLines.add(propertyName + propertyValue);</b>
<i>97</i>&nbsp;		}
<i>98</i>&nbsp;	}
<i>99</i>&nbsp;	
<b class="nc"><i>100</i>&nbsp;	private static String generateParticipantValue(Participant participant, Boolean addRSVP)</b>
<i>101</i>&nbsp;	{
<i>102</i>&nbsp;		//add CN
<b class="nc"><i>103</i>&nbsp;		String participantValue = &#39;CN=&quot;&#39; + participant.name + &#39;&quot;&#39;;</b>
<i>104</i>&nbsp;		//add RSVP
<b class="nc"><i>105</i>&nbsp;		if (addRSVP)</b>
<i>106</i>&nbsp;		{
<b class="nc"><i>107</i>&nbsp;			participantValue += &#39;;RSVP=&#39; + participant.isReplyExpected;</b>
<i>108</i>&nbsp;		}
<i>109</i>&nbsp;		//add SENT-BY
<b class="nc"><i>110</i>&nbsp;		if (String.isNotBlank(participant.delegateEmail))</b>
<i>111</i>&nbsp;		{
<b class="nc"><i>112</i>&nbsp;			participantValue += &#39;;SENT-BY=&quot;MAILTO:&#39; + participant.delegateEmail + &#39;&quot;&#39;;</b>
<i>113</i>&nbsp;		}
<i>114</i>&nbsp;		//add email address of the calendar user
<b class="nc"><i>115</i>&nbsp;		participantValue += &#39;:MAILTO:&#39; + (String.isNotBlank(participant.email)</b>
<b class="nc"><i>116</i>&nbsp;			? participant.email : participant.delegateEmail);</b>
<i>117</i>&nbsp;		
<b class="nc"><i>118</i>&nbsp;		return participantValue;</b>
<i>119</i>&nbsp;	}
<i>120</i>&nbsp;	
<b class="nc"><i>121</i>&nbsp;	private static String formatDateTimeProperty(String propertyName, DateTime dateTimeValue)</b>
<i>122</i>&nbsp;	{           
<b class="nc"><i>123</i>&nbsp;        return (propertyName + &#39;:&#39; + dateTimeValue.formatGmt(DATETIME_FORMAT));</b>
<i>124</i>&nbsp;	}
<i>125</i>&nbsp;	//
<i>126</i>&nbsp;	
<i>127</i>&nbsp;	//
<i>128</i>&nbsp;	//Private methods
<i>129</i>&nbsp;	//
<b class="nc"><i>130</i>&nbsp;	private Boolean isStateCorrect(Boolean forTemplate)</b>
<i>131</i>&nbsp;	{
<b class="nc"><i>132</i>&nbsp;		return (this.startDateTime != null &amp;&amp; this.endDateTime != null</b>
<b class="nc"><i>133</i>&nbsp;			&amp;&amp; this.organizer != null</b>
<b class="nc"><i>134</i>&nbsp;			&amp;&amp; (forTemplate || String.isNotBlank(this.uId)));</b>
<i>135</i>&nbsp;	}
<i>136</i>&nbsp;	
<b class="nc"><i>137</i>&nbsp;	private void addEventDates(List&lt;String&gt; contentLines)</b>
<i>138</i>&nbsp;	{
<b class="nc"><i>139</i>&nbsp;		if (this.isAllDayEvent == true)</b>
<i>140</i>&nbsp;		{   
<b class="nc"><i>141</i>&nbsp;			contentLines.add(formatDateTimeProperty(&#39;DTSTART&#39;, convertLocalTimeToUTC(this.startDateTime)));</b>
<b class="nc"><i>142</i>&nbsp;			contentLines.add(formatDateTimeProperty(&#39;DTEND&#39;, convertLocalTimeToUTC(this.endDateTime)));</b>
<i>143</i>&nbsp;		}
<i>144</i>&nbsp;        else
<i>145</i>&nbsp;		{   
<b class="nc"><i>146</i>&nbsp;			contentLines.add(formatDateTimeProperty(&#39;DTSTART&#39;, this.startDateTime));</b>
<b class="nc"><i>147</i>&nbsp;			contentLines.add(formatDateTimeProperty(&#39;DTEND&#39;, this.endDateTime));</b>
<i>148</i>&nbsp;		}
<i>149</i>&nbsp;	}
<i>150</i>&nbsp;    
<b class="nc"><i>151</i>&nbsp;    private DateTime convertLocalTimeToUTC(DateTime dateTimeValue){</b>
<b class="nc"><i>152</i>&nbsp;        TimeZone organiserTimeZone = UserInfo.getTimeZone();</b>
<b class="nc"><i>153</i>&nbsp;        Integer offset = organiserTimeZone.getOffset(dateTimeValue) / 1000;</b>
<i>154</i>&nbsp;        
<b class="nc"><i>155</i>&nbsp;        return dateTimeValue.addSeconds(-offset);</b>
<i>156</i>&nbsp;    }
<i>157</i>&nbsp;	
<b class="nc"><i>158</i>&nbsp;	private void addRecurrenceRule(List&lt;String&gt; contentLines)</b>
<i>159</i>&nbsp;	{
<b class="nc"><i>160</i>&nbsp;		if (this.recurrentRule != null &amp;&amp; this.recurrentRule.endDateTime != null</b>
<b class="nc"><i>161</i>&nbsp;			&amp;&amp; String.isNotBlank(this.recurrentRule.frequency))</b>
<i>162</i>&nbsp;		{
<b class="nc"><i>163</i>&nbsp;			List&lt;String&gt; attributes = new List&lt;String&gt;();</b>
<i>164</i>&nbsp;			//add frequency which is required
<b class="nc"><i>165</i>&nbsp;			attributes.add(&#39;FREQ=&#39; + this.recurrentRule.frequency);</b>
<i>166</i>&nbsp;			//add INTERVAL (optional)
<b class="nc"><i>167</i>&nbsp;			if (this.recurrentRule.interval != null)</b>
<i>168</i>&nbsp;			{
<b class="nc"><i>169</i>&nbsp;				attributes.add(&#39;INTERVAL=&#39; + this.recurrentRule.interval);</b>
<i>170</i>&nbsp;			}
<i>171</i>&nbsp;			//add BYDAY (optional)
<b class="nc"><i>172</i>&nbsp;			String byDaysAttribute = DC_StringUtils.safeJoin(</b>
<b class="nc"><i>173</i>&nbsp;				this.recurrentRule.byDays, SEPARATOR_OF_ATTRIBUTE_VALUES);</b>
<b class="nc"><i>174</i>&nbsp;			if (String.isNotBlank(byDaysAttribute))</b>
<i>175</i>&nbsp;			{
<b class="nc"><i>176</i>&nbsp;				attributes.add(&#39;BYDAY=&#39; + byDaysAttribute);</b>
<i>177</i>&nbsp;			}
<i>178</i>&nbsp;			//add BYMONTHDAY (optional)
<b class="nc"><i>179</i>&nbsp;			String byMonthDaysAttribute = DC_StringUtils.safeJoin(</b>
<b class="nc"><i>180</i>&nbsp;				this.recurrentRule.byMonthDays, SEPARATOR_OF_ATTRIBUTE_VALUES);</b>
<b class="nc"><i>181</i>&nbsp;			if (String.isNotBlank(byMonthDaysAttribute))</b>
<i>182</i>&nbsp;			{
<b class="nc"><i>183</i>&nbsp;				attributes.add(&#39;BYMONTHDAY=&#39; + byMonthDaysAttribute);</b>
<i>184</i>&nbsp;			}
<i>185</i>&nbsp;			//add BYMONTH (optional)
<b class="nc"><i>186</i>&nbsp;			String byMonthsAttribute = DC_StringUtils.safeJoin(</b>
<b class="nc"><i>187</i>&nbsp;				this.recurrentRule.byMonths, SEPARATOR_OF_ATTRIBUTE_VALUES);</b>
<b class="nc"><i>188</i>&nbsp;			if (String.isNotBlank(byMonthsAttribute))</b>
<i>189</i>&nbsp;			{
<b class="nc"><i>190</i>&nbsp;				attributes.add(&#39;BYMONTH=&#39; + byMonthsAttribute);</b>
<i>191</i>&nbsp;			}
<i>192</i>&nbsp;			//add BYSETPOS (optional)
<b class="nc"><i>193</i>&nbsp;			String daysPositionsAttribute = DC_StringUtils.safeJoin(</b>
<b class="nc"><i>194</i>&nbsp;				this.recurrentRule.positionsOfDays, SEPARATOR_OF_ATTRIBUTE_VALUES);</b>
<b class="nc"><i>195</i>&nbsp;			if (String.isNotBlank(daysPositionsAttribute))</b>
<i>196</i>&nbsp;			{
<b class="nc"><i>197</i>&nbsp;				attributes.add(&#39;BYSETPOS=&#39; + daysPositionsAttribute);</b>
<i>198</i>&nbsp;			}
<i>199</i>&nbsp;			//add UNTIL (required)
<b class="nc"><i>200</i>&nbsp;			attributes.add(&#39;UNTIL=&#39; + this.recurrentRule.endDateTime.formatGmt(DATETIME_FORMAT));</b>
<i>201</i>&nbsp;			
<i>202</i>&nbsp;			//add RECURRENT RULE with all generated attributes
<b class="nc"><i>203</i>&nbsp;			contentLines.add(&#39;RRULE:&#39; + DC_StringUtils.safeJoin(attributes, SEPARATOR_OF_ATTRIBUTES));</b>
<i>204</i>&nbsp;		}
<i>205</i>&nbsp;	}
<i>206</i>&nbsp;	
<b class="nc"><i>207</i>&nbsp;	private void addAlarm(List&lt;String&gt; contentLines)</b>
<i>208</i>&nbsp;	{
<b class="nc"><i>209</i>&nbsp;		if (this.eventAlarm != null &amp;&amp; String.isNotBlank(this.eventAlarm.description)</b>
<b class="nc"><i>210</i>&nbsp;			&amp;&amp; this.eventAlarm.offsetInMinutesFromStart != null)</b>
<i>211</i>&nbsp;		{
<b class="nc"><i>212</i>&nbsp;			contentLines.add(&#39;BEGIN:VALARM&#39;);</b>
<b class="nc"><i>213</i>&nbsp;			contentLines.add(&#39;TRIGGER:&#39;</b>
<b class="nc"><i>214</i>&nbsp;				+ (this.eventAlarm.offsetInMinutesFromStart &lt;= 0 ? &#39;-&#39; : &#39;+&#39;)</b>
<b class="nc"><i>215</i>&nbsp;				+ &#39;PT&#39; + Math.abs(this.eventAlarm.offsetInMinutesFromStart) + &#39;M&#39;);</b>
<i>216</i>&nbsp;			//currently the system supports &#39;DISPLAY&#39; action only 
<b class="nc"><i>217</i>&nbsp;			contentLines.add(&#39;ACTION:DISPLAY&#39;);</b>
<b class="nc"><i>218</i>&nbsp;			contentLines.add(&#39;DESCRIPTION:&#39; +</b>
<b class="nc"><i>219</i>&nbsp;				DC_ICalendarContentUtils.escapeTextValue(this.eventAlarm.description));</b>
<b class="nc"><i>220</i>&nbsp;			contentLines.add(&#39;END:VALARM&#39;);</b>
<i>221</i>&nbsp;		}
<i>222</i>&nbsp;	}
<i>223</i>&nbsp;	//
<i>224</i>&nbsp;	
<i>225</i>&nbsp;	//
<i>226</i>&nbsp;	//Public methods
<i>227</i>&nbsp;	//
<b class="nc"><i>228</i>&nbsp;	public void setStatus(String status)</b>
<i>229</i>&nbsp;	{
<i>230</i>&nbsp;		//1) set status
<b class="nc"><i>231</i>&nbsp;		this.status = status;</b>
<i>232</i>&nbsp;		//2) set method
<b class="nc"><i>233</i>&nbsp;		this.method = getMethodForStatus(status);</b>
<i>234</i>&nbsp;	}
<i>235</i>&nbsp;	
<i>236</i>&nbsp;	/*
<i>237</i>&nbsp;	The method builds correct content for an ics-file.
<i>238</i>&nbsp;	All special chars in TEXT fields should be escaped otherwise a content will
<i>239</i>&nbsp;	not be correct.	Here is the list of properties which have TEXT data type: PRODID,
<i>240</i>&nbsp;	VERSION, METHOD, CN, DESCRIPTION, X-ALT-DESC, LOCATION, STATUS, SUMMARY, TRANSP.
<i>241</i>&nbsp;	As for now, I&#39;m sure that PRODID, VERSION, METHOD, STATUS and TRANSP properties
<i>242</i>&nbsp;	always have	correct values, that&#39;s why I don&#39;t escape their	values and it allows
<i>243</i>&nbsp;	me to get a better performance of this method. So, I directly escape only the
<i>244</i>&nbsp;	following properties: DESCRIPTION, X-ALT-DESC, LOCATION, SUMMARY. And I use
<i>245</i>&nbsp;	double quotes around CN values instead of escaping of its value. So, if the
<i>246</i>&nbsp;	situation is changed then we will have to directly escape the values for other
<i>247</i>&nbsp;	fields.
<i>248</i>&nbsp;	*/
<b class="nc"><i>249</i>&nbsp;	public String buildContent(Boolean forTemplate)</b>
<i>250</i>&nbsp;	{
<i>251</i>&nbsp;		//if the state of the builder is not correct then return null
<b class="nc"><i>252</i>&nbsp;		if (!isStateCorrect(forTemplate))</b>
<i>253</i>&nbsp;		{
<b class="nc"><i>254</i>&nbsp;			return null;</b>
<i>255</i>&nbsp;		}
<i>256</i>&nbsp;		
<b class="nc"><i>257</i>&nbsp;		List&lt;String&gt; contentLines = new List&lt;String&gt;();</b>
<i>258</i>&nbsp;		//start the file
<b class="nc"><i>259</i>&nbsp;		contentLines.add(&#39;BEGIN:VCALENDAR&#39;);</b>
<i>260</i>&nbsp;		//add some system parameters of the file
<i>261</i>&nbsp;		//- method is optional
<b class="nc"><i>262</i>&nbsp;		addNonBlankContentLine(contentLines, &#39;METHOD:&#39;,</b>
<b class="nc"><i>263</i>&nbsp;			(forTemplate ? DC_ICalendarPlaceholder.METHOD : this.method));</b>
<b class="nc"><i>264</i>&nbsp;		contentLines.add(&#39;PRODID:&#39; + PRODUCT_ID);</b>
<b class="nc"><i>265</i>&nbsp;		contentLines.add(&#39;VERSION:&#39; + VERSION);</b>
<i>266</i>&nbsp;		
<i>267</i>&nbsp;		//start the event
<b class="nc"><i>268</i>&nbsp;		contentLines.add(&#39;BEGIN:VEVENT&#39;);</b>
<i>269</i>&nbsp;		//add organizer details
<b class="nc"><i>270</i>&nbsp;		contentLines.add(&#39;ORGANIZER;&#39; + generateParticipantValue(this.organizer, false));</b>
<i>271</i>&nbsp;		
<i>272</i>&nbsp;		//add event dates
<b class="nc"><i>273</i>&nbsp;		this.addEventDates(contentLines);</b>
<i>274</i>&nbsp;	    //summary is optional
<b class="nc"><i>275</i>&nbsp;		addNonBlankContentLine(contentLines, &#39;SUMMARY:&#39;,</b>
<b class="nc"><i>276</i>&nbsp;			DC_ICalendarContentUtils.escapeTextValue(this.summary));</b>
<i>277</i>&nbsp;		//location is optional
<b class="nc"><i>278</i>&nbsp;		addNonBlankContentLine(contentLines, &#39;LOCATION:&#39;,</b>
<b class="nc"><i>279</i>&nbsp;			DC_ICalendarContentUtils.escapeTextValue(this.location));</b>
<i>280</i>&nbsp;		//TRY TO ADD a RECERRENCE RULE FOR the EVENT
<b class="nc"><i>281</i>&nbsp;		this.addRecurrenceRule(contentLines);</b>
<i>282</i>&nbsp;		
<i>283</i>&nbsp;		//add attendees
<b class="nc"><i>284</i>&nbsp;	    for (Participant attendee : this.attendees)</b>
<b class="nc"><i>285</i>&nbsp;	    {</b>
<b class="nc"><i>286</i>&nbsp;	    	if (attendee != null)</b>
<i>287</i>&nbsp;	    	{
<b class="nc"><i>288</i>&nbsp;	    		contentLines.add(&#39;ATTENDEE;&#39; + generateParticipantValue(attendee, true));</b>
<i>289</i>&nbsp;	    	}
<i>290</i>&nbsp;	    }
<i>291</i>&nbsp;	    
<i>292</i>&nbsp;	    //add HTML-desciption (it&#39;s optional)
<b class="nc"><i>293</i>&nbsp;	    addNonBlankContentLine(contentLines, &#39;X-ALT-DESC;FMTTYPE=text/html:&#39;,</b>
<b class="nc"><i>294</i>&nbsp;	    	DC_ICalendarContentUtils.escapeTextValue(this.htmlDescription));</b>
<i>295</i>&nbsp;	    //add plain text description (it&#39;s optional)
<b class="nc"><i>296</i>&nbsp;	    addNonBlankContentLine(contentLines, &#39;DESCRIPTION:&#39;,</b>
<b class="nc"><i>297</i>&nbsp;	    	DC_ICalendarContentUtils.escapeTextValue(this.description));</b>
<i>298</i>&nbsp;		
<i>299</i>&nbsp;		//add UID
<b class="nc"><i>300</i>&nbsp;		contentLines.add(&#39;UID:&#39; + (forTemplate ? DC_ICalendarPlaceholder.UID : this.uId));</b>
<i>301</i>&nbsp;		//add STATUS (it&#39;s optional)
<b class="nc"><i>302</i>&nbsp;		addNonBlankContentLine(contentLines, &#39;STATUS:&#39;,</b>
<b class="nc"><i>303</i>&nbsp;			(forTemplate ? DC_ICalendarPlaceholder.STATUS : this.status));</b>
<i>304</i>&nbsp;		
<i>305</i>&nbsp;		//add some other system parameters
<b class="nc"><i>306</i>&nbsp;		contentLines.add(&#39;CLASS:&#39; + DEFAULT_CLASS);</b>
<b class="nc"><i>307</i>&nbsp;		contentLines.add(&#39;PRIORITY:&#39; + DEFAULT_PRIORITY);</b>
<b class="nc"><i>308</i>&nbsp;		contentLines.add(&#39;TRANSP:&#39; + DEFAULT_TRANSPARENCY);</b>
<b class="nc"><i>309</i>&nbsp;		contentLines.add(&#39;SEQUENCE:&#39; + DEFAULT_SEQUENCE);</b>
<i>310</i>&nbsp;		
<b class="nc"><i>311</i>&nbsp;		String currentDateTimeStamp = DateTime.now().formatGmt(DATETIME_FORMAT);</b>
<b class="nc"><i>312</i>&nbsp;		contentLines.add(&#39;DTSTAMP:&#39; + currentDateTimeStamp);</b>
<b class="nc"><i>313</i>&nbsp;		contentLines.add(&#39;CREATED:&#39; + currentDateTimeStamp);</b>
<b class="nc"><i>314</i>&nbsp;		contentLines.add(&#39;LAST-MODIFIED:&#39; + currentDateTimeStamp);</b>
<i>315</i>&nbsp;		
<i>316</i>&nbsp;		//TRY TO ADD an ALARM FOR the EVENT
<b class="nc"><i>317</i>&nbsp;		this.addAlarm(contentLines);</b>
<i>318</i>&nbsp;		
<i>319</i>&nbsp;		//complete the event and the file
<b class="nc"><i>320</i>&nbsp;		contentLines.add(&#39;END:VEVENT&#39;);</b>
<b class="nc"><i>321</i>&nbsp;		contentLines.add(&#39;END:VCALENDAR&#39;);</b>
<i>322</i>&nbsp;        
<b class="nc"><i>323</i>&nbsp;		return String.join(contentLines, SEPARATOR_OF_CONTENT_LINES);</b>
<i>324</i>&nbsp;	}
<i>325</i>&nbsp;	//
<i>326</i>&nbsp;	
<i>327</i>&nbsp;	
<i>328</i>&nbsp;	//
<i>329</i>&nbsp;	//Public static methods
<i>330</i>&nbsp;	//
<b class="nc"><i>331</i>&nbsp;	public static String getMethodForStatus(String status)</b>
<i>332</i>&nbsp;	{
<b class="nc"><i>333</i>&nbsp;		if (status == STATUS_CONFIRMED || status == STATUS_TENTATIVE)</b>
<i>334</i>&nbsp;		{
<b class="nc"><i>335</i>&nbsp;			return REQUEST_METHOD;</b>
<i>336</i>&nbsp;		}
<b class="nc"><i>337</i>&nbsp;		else if (status == STATUS_CANCELLED)</b>
<i>338</i>&nbsp;		{
<b class="nc"><i>339</i>&nbsp;			return CANCEL_METHOD;</b>
<i>340</i>&nbsp;		}
<b class="nc"><i>341</i>&nbsp;		return null;</b>
<i>342</i>&nbsp;	}
<i>343</i>&nbsp;	//
<i>344</i>&nbsp;	
<i>345</i>&nbsp;	
<i>346</i>&nbsp;	//
<i>347</i>&nbsp;	//Data types
<i>348</i>&nbsp;	//
<i>349</i>&nbsp;	public class Participant
<i>350</i>&nbsp;	{
<i>351</i>&nbsp;		//
<i>352</i>&nbsp;		//Constructors
<i>353</i>&nbsp;		//
<b class="nc"><i>354</i>&nbsp;		public Participant(String name, String email, String delegateEmail, Boolean isReplyExpected)</b>
<i>355</i>&nbsp;		{
<b class="nc"><i>356</i>&nbsp;			this.name = name;</b>
<b class="nc"><i>357</i>&nbsp;			this.email = (String.isNotBlank(email) ? email : UNKNOWN_EMAIL);</b>
<b class="nc"><i>358</i>&nbsp;			this.delegateEmail = delegateEmail;</b>
<b class="nc"><i>359</i>&nbsp;			this.isReplyExpected = isReplyExpected;</b>
<i>360</i>&nbsp;		}
<i>361</i>&nbsp;		
<b class="nc"><i>362</i>&nbsp;		public Participant(String name, String email, Boolean isReplyExpected)</b>
<i>363</i>&nbsp;		{
<b class="nc"><i>364</i>&nbsp;			this(name, email, null, isReplyExpected);</b>
<i>365</i>&nbsp;		}
<i>366</i>&nbsp;		//
<i>367</i>&nbsp;		
<i>368</i>&nbsp;		//
<i>369</i>&nbsp;		//Properties
<i>370</i>&nbsp;		//
<b class="nc"><i>371</i>&nbsp;		public String name {get; set;}</b>
<b class="nc"><i>372</i>&nbsp;		public String email {get; set;}</b>
<b class="nc"><i>373</i>&nbsp;		public String delegateEmail {get; set;}</b>
<b class="nc"><i>374</i>&nbsp;		public Boolean isReplyExpected {get; set;}</b>
<i>375</i>&nbsp;		//
<i>376</i>&nbsp;	}
<i>377</i>&nbsp;	
<i>378</i>&nbsp;	public class Alarm
<i>379</i>&nbsp;	{
<i>380</i>&nbsp;		//
<i>381</i>&nbsp;		//Properties
<i>382</i>&nbsp;		//
<b class="nc"><i>383</i>&nbsp;		public String description {get; set;}</b>
<b class="nc"><i>384</i>&nbsp;		public Integer offsetInMinutesFromStart {get; set;}</b>
<i>385</i>&nbsp;		//
<i>386</i>&nbsp;	}
<i>387</i>&nbsp;	
<i>388</i>&nbsp;	public class RecurrenceRule
<i>389</i>&nbsp;	{
<i>390</i>&nbsp;		//
<i>391</i>&nbsp;		//Properties
<i>392</i>&nbsp;		//
<i>393</i>&nbsp;		//FREQ
<b class="nc"><i>394</i>&nbsp;		public String frequency {get; set;}</b>
<i>395</i>&nbsp;		//INTERVAL
<b class="nc"><i>396</i>&nbsp;		public Integer interval {get; set;}</b>
<i>397</i>&nbsp;		//BYDAY
<b class="nc"><i>398</i>&nbsp;		public String[] byDays {get; set;}</b>
<i>399</i>&nbsp;		//BYMONTH
<b class="nc"><i>400</i>&nbsp;		public Integer[] byMonths {get; set;}</b>
<i>401</i>&nbsp;		//BYMONTHDAY
<b class="nc"><i>402</i>&nbsp;		public Integer[] byMonthDays {get; set;}</b>
<i>403</i>&nbsp;		//BYSETPOS
<b class="nc"><i>404</i>&nbsp;		public Integer[] positionsOfDays {get; set;}</b>
<i>405</i>&nbsp;		//UNTIL
<b class="nc"><i>406</i>&nbsp;		public DateTime endDateTime {get; set;}</b>
<i>407</i>&nbsp;		//
<i>408</i>&nbsp;	}
<i>409</i>&nbsp;	//
<i>410</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2024-12-10 16:19</div>
</div>
</body>
</html>
