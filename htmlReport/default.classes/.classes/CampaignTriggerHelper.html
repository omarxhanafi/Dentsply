


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: CampaignTriggerHelper</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">default.classes</a> ]
</div>

<h1>Coverage Summary for Class: CampaignTriggerHelper (default.classes)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">CampaignTriggerHelper</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/ 1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    83.3%
  </span>
  <span class="absValue">
    (249/ 299)
  </span>
</td>
</tr>

</table>

<br/>
<br/>

<h2>CampaignTriggerHelper</h2>
<div class="sourceCode"><i>1</i>&nbsp;/*-------------------------------------------------------------------------------------------------------
<i>2</i>&nbsp;Author:         Ahmed LOUDRASSI (Salesforce) 20191023
<i>3</i>&nbsp;Description:    Campaign  Trigger Helper Class
<i>4</i>&nbsp;Test Class:     Test_CampaignTrigger
<i>5</i>&nbsp;History
<i>6</i>&nbsp;23/10/2019   Ahmed LOUDRASSI  Migrated  CampMgmtCampaignSessionTrigger, CampMgmtCampaignTrigger, CampMgmtCampaignTrigger2, CampMgmtCampaignSharingTrigger triggers. (#)
<i>7</i>&nbsp;23/10/2019   Ahmed LOUDRASSI  Migrated Campaign Workflows. (#)
<i>8</i>&nbsp;02/01/2020   Miguel           Bug fix setCampaignMemberStatus + Do not create sharing record if Owner  &lt;&gt; Approver (TFUS-000001389)
<i>9</i>&nbsp;17/08/2021   Richard          Added details for new Campaign record type &#39;In-person &amp; Virtual Event Campaign&#39;
<i>10</i>&nbsp;29/07/2022   Roberto Narbona  TFUS-000004576
<i>11</i>&nbsp;13/11/2023   Houssam ADIB     TFUS-000006137 Is Converted field logic
<i>12</i>&nbsp;15/01/2024	 Miguel Coimbra	  TFUS-000006400 - Session Campaign Record Type
<i>13</i>&nbsp;01/02/2024	 Houssam ADIB	  TFUS-000006365 - Delete Child Session Campaigns if the parent campaign is deleted
<i>14</i>&nbsp;25/04/2024	 Roberto		  TFUS-000006632 - Delete some campaign member status
<i>15</i>&nbsp;----------------------------------------------------------------------------------------*/
<i>16</i>&nbsp;public with sharing class CampaignTriggerHelper {
<i>17</i>&nbsp;    /*------------------------------------------------------------
<i>18</i>&nbsp;    Description:    Method migrated from  CampMgmtCampaignSessionTrigger
<i>19</i>&nbsp;
<i>20</i>&nbsp;    Inputs:         @param newCampaignList
<i>21</i>&nbsp;    ------------------------------------------------------------*/
<b class="fc"><i>22</i>&nbsp;    public  static void setCampaignSessionsDefaultValues(List&lt;Campaign&gt; newCampaignList)  {</b>
<b class="fc"><i>23</i>&nbsp;        BatchSettings__c settings = BatchSettings__c.getInstance(&#39;Default&#39;);</b>
<b class="fc"><i>24</i>&nbsp;        if (Test.isRunningTest() || settings.CampMgmtCampaignSessionTriggerIsEnabled__c){</b>
<b class="fc"><i>25</i>&nbsp;            RecordType rtDiCampaignSession = [SELECT Id FROM RecordType WHERE DeveloperName = &#39;DI_Campaign_Session&#39; AND SObjectType = &#39;Campaign&#39;];</b>
<b class="fc"><i>26</i>&nbsp;            Set&lt;ID&gt; campaignIdList = new Set&lt;ID&gt;();</b>
<b class="fc"><i>27</i>&nbsp;            for (Campaign session : newCampaignList) {</b>
<b class="fc"><i>28</i>&nbsp;                if (session.RecordTypeId == rtDiCampaignSession.Id &amp;&amp; session.Parent_Event__c != null)</b>
<b class="fc"><i>29</i>&nbsp;                    campaignIdList.add(session.Parent_Event__c);</b>
<i>30</i>&nbsp;            }
<i>31</i>&nbsp;
<b class="fc"><i>32</i>&nbsp;            Map&lt;ID, Campaign&gt; campaignMap = new Map&lt;ID, Campaign&gt;(</b>
<b class="fc"><i>33</i>&nbsp;                [SELECT Id, StartDate, EndDate, Strategy__c, Profession__c, Brand__c, Target_Group__c, Target_Type__c</b>
<i>34</i>&nbsp;                FROM Campaign
<b class="fc"><i>35</i>&nbsp;                WHERE Id IN :campaignIdList]);</b>
<b class="fc"><i>36</i>&nbsp;            for (Campaign session : newCampaignList) {</b>
<b class="fc"><i>37</i>&nbsp;                if (session.RecordTypeId == rtDiCampaignSession.Id) {</b>
<b class="fc"><i>38</i>&nbsp;                    Campaign campaign = campaignMap.get(session.Parent_Event__c);</b>
<b class="fc"><i>39</i>&nbsp;                    if (session.Session_Start_Date_Time__c == null &amp;&amp; campaign.StartDate != null)</b>
<b class="fc"><i>40</i>&nbsp;                        session.Session_Start_Date_Time__c = campaign.StartDate;</b>
<b class="fc"><i>41</i>&nbsp;                    if (session.Session_End_Date_Time__c == null &amp;&amp; campaign.EndDate != null)</b>
<b class="nc"><i>42</i>&nbsp;                        session.Session_End_Date_Time__c = campaign.EndDate;</b>
<b class="fc"><i>43</i>&nbsp;                    if (session.Strategy__c == null &amp;&amp; campaign.Strategy__c != null)</b>
<b class="nc"><i>44</i>&nbsp;                        session.Strategy__c = campaign.Strategy__c;</b>
<b class="fc"><i>45</i>&nbsp;                    if (session.Profession__c == null &amp;&amp; campaign.Profession__c != null)</b>
<b class="nc"><i>46</i>&nbsp;                        session.Profession__c = campaign.Profession__c;</b>
<b class="fc"><i>47</i>&nbsp;                    if (session.Brand__c == null &amp;&amp; campaign.Brand__c != null)</b>
<b class="nc"><i>48</i>&nbsp;                        session.Brand__c = campaign.Brand__c;</b>
<b class="fc"><i>49</i>&nbsp;                    if (session.Target_Group__c == null &amp;&amp; campaign.Target_Group__c != null)</b>
<b class="nc"><i>50</i>&nbsp;                        session.Target_Group__c = campaign.Target_Group__c;</b>
<b class="fc"><i>51</i>&nbsp;                    if (session.Target_Type__c == null &amp;&amp; campaign.Target_Type__c != null)</b>
<b class="nc"><i>52</i>&nbsp;                        session.Target_Type__c = campaign.Target_Type__c;</b>
<i>53</i>&nbsp;                }
<i>54</i>&nbsp;            }
<i>55</i>&nbsp;        }
<i>56</i>&nbsp;    }
<i>57</i>&nbsp;    /*------------------------------------------------------------
<i>58</i>&nbsp;    Description:    Method migrated from  CampMgmtCampaignTrigger
<i>59</i>&nbsp;
<i>60</i>&nbsp;    Inputs:         @param newCampaignMap
<i>61</i>&nbsp;    ------------------------------------------------------------*/
<b class="fc"><i>62</i>&nbsp;    public  static void setCampaignMemberStatus(Map&lt;Id, Campaign&gt; newCampaignMap)  {</b>
<b class="fc"><i>63</i>&nbsp;        BatchSettings__c settings = BatchSettings__c.getInstance(&#39;Default&#39;);</b>
<b class="fc"><i>64</i>&nbsp;        if (Test.isRunningTest() || settings.CampMgmtCampaignTriggerIsEnabled__c) {</b>
<b class="fc"><i>65</i>&nbsp;            List&lt;CampaignMemberStatus&gt; statiTempInsert = new List&lt;CampaignMemberStatus&gt;();</b>
<b class="fc"><i>66</i>&nbsp;            List&lt;CampaignMemberStatus&gt; statiDelete = new List&lt;CampaignMemberStatus&gt;();</b>
<b class="fc"><i>67</i>&nbsp;            List&lt;CampaignMemberStatus&gt; statiInsert = new List&lt;CampaignMemberStatus&gt;();</b>
<b class="fc"><i>68</i>&nbsp;            List&lt;Id&gt; campaignIds = new List&lt;Id&gt;();</b>
<b class="fc"><i>69</i>&nbsp;            Map&lt;String, String&gt; includedRecordTypes = new Map&lt;String, String&gt; {&#39;DI_Campaign&#39; =&gt; &#39;DI_Campaign&#39;, </b>
<b class="fc"><i>70</i>&nbsp;                &#39;NA_Activity_Request_Form&#39; =&gt; &#39;NA_Activity_Request_Form&#39;, </b>
<b class="fc"><i>71</i>&nbsp;                &#39;NATradeShow&#39; =&gt; &#39;NATradeShow&#39;,</b>
<b class="fc"><i>72</i>&nbsp;                &#39;NA_Sponsorship&#39; =&gt; &#39;NA_Sponsorship&#39;, </b>
<b class="fc"><i>73</i>&nbsp;                &#39;DI_Mailing&#39; =&gt; &#39;DI_Mailing&#39;, </b>
<b class="fc"><i>74</i>&nbsp;                &#39;DNA_Campaign&#39; =&gt; &#39;DNA_Campaign&#39;, </b>
<b class="fc"><i>75</i>&nbsp;                &#39;Inside_Sales_Campaign&#39; =&gt; &#39;Inside_Sales_Campaign&#39;,</b>
<b class="fc"><i>76</i>&nbsp;                &#39;Digital_Marketing_Campaign&#39; =&gt; &#39;Digital_Marketing_Campaign&#39;,</b>
<b class="fc"><i>77</i>&nbsp;                &#39;CventCampaign&#39; =&gt; &#39;CventCampaign&#39;,</b>
<b class="fc"><i>78</i>&nbsp;                &#39;InPersonEventCampaign&#39; =&gt; &#39;InPersonEventCampaign&#39;,</b>
<b class="fc"><i>79</i>&nbsp;				&#39;CVENT_Session_Campaign&#39; =&gt; &#39;CVENT_Session_Campaign&#39;};</b>
<b class="fc"><i>80</i>&nbsp;            Map&lt;String, String&gt; rtDiCampaignList = new Map&lt;String, String&gt; {&#39;DI_Campaign&#39; =&gt; &#39;DI_Campaign&#39;,</b>
<b class="fc"><i>81</i>&nbsp;                &#39;NA_Activity_Request_Form&#39; =&gt; &#39;NA_Activity_Request_Form&#39;, </b>
<b class="fc"><i>82</i>&nbsp;                &#39;NATradeShow&#39; =&gt; &#39;NATradeShow&#39;, &#39;NA_Sponsorship&#39; =&gt; &#39;NA_Sponsorship&#39;};</b>
<i>83</i>&nbsp;
<b class="fc"><i>84</i>&nbsp;            for(Campaign campaign : newCampaignMap.values()) {</b>
<b class="fc"><i>85</i>&nbsp;                CampaignMemberStatus status;</b>
<b class="fc"><i>86</i>&nbsp;                campaignIds.add(campaign.Id);</b>
<b class="fc"><i>87</i>&nbsp;                if (GlobalUtils.ifrecordTypeInList(&#39;Campaign&#39;, rtDiCampaignList.values(), campaign.RecordTypeId)) {</b>
<b class="fc"><i>88</i>&nbsp;                    statiTempInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Temporary&#39;, 99, true, true));</b>
<b class="fc"><i>89</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Suggested&#39;, 3, true, false));</b>
<b class="fc"><i>90</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Invited&#39;, 4, false, false));</b>
<b class="fc"><i>91</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Confirmed&#39;, 5, false, true));</b>
<b class="fc"><i>92</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Waiting List&#39;, 6, false, false));</b>
<b class="fc"><i>93</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Cancelled&#39;, 7, false, false));</b>
<b class="fc"><i>94</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Did Not Attend&#39;, 8, false, false));</b>
<b class="fc"><i>95</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Campaign Was Cancelled&#39;, 9, false, false));</b>
<b class="fc"><i>96</i>&nbsp;                } else if (campaign.RecordTypeId.equals(GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;DI_Mailing&#39;))) {</b>
<b class="fc"><i>97</i>&nbsp;                    statiTempInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Temporary&#39;, 99, true, true));</b>
<b class="fc"><i>98</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Suggested&#39;, 3, true, false));</b>
<b class="fc"><i>99</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Sent&#39;, 4, false, false));</b>
<b class="fc"><i>100</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Responded&#39;, 5, false, true));</b>
<b class="fc"><i>101</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Completed&#39;, 6, false, true));</b>
<b class="fc"><i>102</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Campaign Was Cancelled&#39;, 7, false, false));</b>
<b class="fc"><i>103</i>&nbsp;                } else if (campaign.RecordTypeId.equals(GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;DNA_Campaign&#39;))) {</b>
<b class="fc"><i>104</i>&nbsp;                    statiTempInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Temporary&#39;, 99, true, true));</b>
<b class="fc"><i>105</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;To Call&#39;, 3, true, false));</b>
<b class="fc"><i>106</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;In Progress&#39;, 4, false, false));</b>
<b class="fc"><i>107</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Busy&#39;, 5, false, false));</b>
<b class="fc"><i>108</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;No Answer&#39;, 6, false, false));</b>
<b class="fc"><i>109</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Left Message&#39;, 7, false, false));</b>
<b class="fc"><i>110</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Call Back Later&#39;, 8, false, false));</b>
<b class="fc"><i>111</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Call Completed&#39;, 9, false, true));</b>
<b class="fc"><i>112</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Not Completed&#39;, 10, false, false));</b>
<b class="fc"><i>113</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Bounced&#39;, 11, false, false));</b>
<b class="fc"><i>114</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Sent&#39;, 12, false, true));</b>
<b class="fc"><i>115</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Failure&#39;, 13, false, false));</b>
<b class="fc"><i>116</i>&nbsp;                } else if (campaign.RecordTypeId.equals(GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;Inside_Sales_Campaign&#39;))) {</b>
<b class="fc"><i>117</i>&nbsp;                    statiTempInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Temporary&#39;, 99, true, true));</b>
<b class="fc"><i>118</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;To Call&#39;, 3, true, false));</b>
<b class="fc"><i>119</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;In Progress&#39;, 4, false, false));</b>
<b class="fc"><i>120</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Busy&#39;, 5, false, false));</b>
<b class="fc"><i>121</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;No Answer&#39;, 6, false, false));</b>
<b class="fc"><i>122</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Left Message&#39;, 7, false, false));</b>
<b class="fc"><i>123</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Call Back Later&#39;, 8, false, false));</b>
<b class="fc"><i>124</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Call Completed&#39;, 9, false, true));</b>
<b class="fc"><i>125</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Not Completed&#39;, 10, false, false));</b>
<b class="fc"><i>126</i>&nbsp;                 	statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Bounced&#39;, 11, false, false));</b>
<b class="fc"><i>127</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Sent&#39;, 12, false, true));</b>
<b class="fc"><i>128</i>&nbsp;					statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Failure&#39;, 13, false, false));</b>
<b class="fc"><i>129</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Canceled&#39;, 14, false, false));</b>
<i>130</i>&nbsp;
<b class="fc"><i>131</i>&nbsp;                } else if (campaign.RecordTypeId.equals(GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;Digital_Marketing_Campaign&#39;))) {</b>
<b class="fc"><i>132</i>&nbsp;                    statiTempInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Temporary&#39;, 99, true, true));</b>
<b class="fc"><i>133</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Registered&#39;, 3, true, false));</b>
<b class="fc"><i>134</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Responded&#39;, 4, false, true));</b>
<b class="fc"><i>135</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;To be Reconciled&#39;, 5, false, false));</b>
<b class="fc"><i>136</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Assigned to Sales&#39;, 6, false, false));</b>
<b class="fc"><i>137</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Sales Lead Cancelled&#39;, 7, false, false));</b>
<b class="fc"><i>138</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Opportunity Created&#39;, 8, false, false));</b>
<b class="fc"><i>139</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Opportunity Closed Won&#39;, 9, false, false));</b>
<b class="fc"><i>140</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Opportunity Closed Lost&#39;, 10, false, false));</b>
<b class="fc"><i>141</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Removed From Campaign&#39;, 11, false, false));</b>
<i>142</i>&nbsp;                }
<b class="fc"><i>143</i>&nbsp;                else if (campaign.RecordTypeId.equals(GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;InPersonEventCampaign&#39;))) {</b>
<b class="nc"><i>144</i>&nbsp;                    statiTempInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Temporary&#39;, 99, true, true));</b>
<b class="nc"><i>145</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Invitation Pending&#39;, 3, true, false));</b>
<b class="nc"><i>146</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Accepted&#39;, 4, false, false));</b>
<b class="nc"><i>147</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Declined&#39;, 5, false, false));</b>
<b class="nc"><i>148</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Visited&#39;, 6, false, true));</b>
<b class="nc"><i>149</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Waitlisted&#39;, 7, false, false));</b>
<b class="nc"><i>150</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Removed From Campaign&#39;, 8, false, false));</b>
<i>151</i>&nbsp;                }
<b class="fc"><i>152</i>&nbsp;                else if (campaign.RecordTypeId.equals(GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;CventCampaign&#39;)))</b>
<i>153</i>&nbsp;                {
<b class="fc"><i>154</i>&nbsp;                    statiTempInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Temporary&#39;, 99, true, true));</b>
<b class="fc"><i>155</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Pending Approval&#39;, 3, true, false));</b>
<b class="fc"><i>156</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;No Response&#39;, 4, false, false));</b>
<b class="fc"><i>157</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Accepted&#39;, 5, false, false));</b>
<b class="fc"><i>158</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Declined&#39;, 6, false, true));</b>
<b class="fc"><i>159</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Visited&#39;, 7, false, true));</b>
<b class="fc"><i>160</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Waitlisted&#39;, 8, false, true));</b>
<b class="fc"><i>161</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Cancelled&#39;, 9, false, true));</b>
<i>162</i>&nbsp;                }
<b class="fc"><i>163</i>&nbsp;				else if (campaign.RecordTypeId.equals(GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;CVENT_Session_Campaign&#39;)))</b>
<i>164</i>&nbsp;                {
<b class="fc"><i>165</i>&nbsp;                    statiTempInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Temporary&#39;, 99, true, true));</b>
<b class="fc"><i>166</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Added to Session Waitlist&#39;, 3, true, false));</b>
<b class="fc"><i>167</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Registered for Session&#39;, 4, false, true));</b>
<b class="fc"><i>168</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Canceled Registration for Session&#39;, 5, false, false));</b>
<b class="fc"><i>169</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Checked in to Session&#39;, 6, false, true));</b>
<b class="fc"><i>170</i>&nbsp;                    statiInsert.add(returnCampaignMemberStatus(campaign.Id,&#39;Submitted Session Feedback&#39;, 7, false, true));</b>
<i>171</i>&nbsp;                }
<i>172</i>&nbsp;                //Cvent attendee statuses:
<i>173</i>&nbsp;                // - No response
<i>174</i>&nbsp;                // - Accepted
<i>175</i>&nbsp;                // - Declined
<i>176</i>&nbsp;                // - Visited
<i>177</i>&nbsp;                // - Waitlisted
<i>178</i>&nbsp;                // - Cancelled
<i>179</i>&nbsp;                // - Pending Approval
<i>180</i>&nbsp;                // - Denied Approval
<i>181</i>&nbsp;                // - Invitation Not Sent
<i>182</i>&nbsp;                // - Invitation Pending
<i>183</i>&nbsp;                // - Nomination Pending
<i>184</i>&nbsp;                // - Nomination Approved
<i>185</i>&nbsp;                // - Nomination Denied
<i>186</i>&nbsp;                // - Registration Pending
<i>187</i>&nbsp;                
<b class="fc"><i>188</i>&nbsp;            if(GlobalUtils.ifrecordTypeInList(&#39;Campaign&#39;, includedRecordTypes.values(), campaign.RecordTypeId)){</b>
<b class="fc"><i>189</i>&nbsp;            	statiDelete = [SELECT Id FROM CampaignMemberStatus WHERE CampaignId IN :campaignIds];</b>
<i>190</i>&nbsp;            }
<i>191</i>&nbsp;                                
<i>192</i>&nbsp;            }
<i>193</i>&nbsp;                        
<b class="fc"><i>194</i>&nbsp;            try {</b>
<b class="fc"><i>195</i>&nbsp;                if(!statiTempInsert.isEmpty()){</b>
<b class="fc"><i>196</i>&nbsp;                     insert statiTempInsert;// Insert temporary default stati while we clear out the rest.</b>
<i>197</i>&nbsp;                }
<b class="fc"><i>198</i>&nbsp;                if(!statiDelete.isEmpty()){</b>
<b class="nc"><i>199</i>&nbsp;                     delete statiDelete; // Delete all old stati that were there before the operation.</b>
<i>200</i>&nbsp;                }
<b class="fc"><i>201</i>&nbsp;                if(!statiInsert.isEmpty()){</b>
<b class="fc"><i>202</i>&nbsp;                     insert statiInsert; // Insert all new stati that should be there after the operation.</b>
<i>203</i>&nbsp;                }
<b class="fc"><i>204</i>&nbsp;                if(!statiTempInsert.isEmpty()){</b>
<b class="fc"><i>205</i>&nbsp;                     delete statiTempInsert; // Delete temporary default stati again.</b>
<i>206</i>&nbsp;                }
<b class="fc"><i>207</i>&nbsp;            } catch (DmlException e) {</b>
<b class="fc"><i>208</i>&nbsp;                    DebugLog.addException(e, &#39;Method: CampaignTriggerHandler.setCampaignMemberStatus&#39;); </b>
<i>209</i>&nbsp;            }
<i>210</i>&nbsp;        }
<i>211</i>&nbsp;    }
<i>212</i>&nbsp;    /*------------------------------------------------------------
<i>213</i>&nbsp;    Description:    Method migrated from  CampMgmtCampaignTrigger2
<i>214</i>&nbsp;
<i>215</i>&nbsp;    Inputs:         @param newCampaignMap, oldCampaignMap
<i>216</i>&nbsp;    ------------------------------------------------------------*/
<b class="fc"><i>217</i>&nbsp;    public  static void deactivateCampaignSessions(Map&lt;Id, Campaign&gt; newCampaignMap, Map&lt;Id, Campaign&gt; oldCampaignMap)  {</b>
<b class="fc"><i>218</i>&nbsp;        BatchSettings__c settings = BatchSettings__c.getInstance(&#39;Default&#39;);</b>
<b class="fc"><i>219</i>&nbsp;        if (Test.isRunningTest() || settings.CampMgmtCampaignTriggerIsEnabled__c) {</b>
<b class="fc"><i>220</i>&nbsp;            Id[] campaignIdList = new Id[] {};</b>
<b class="fc"><i>221</i>&nbsp;            for (Campaign campaign : newCampaignMap.values()) {</b>
<b class="fc"><i>222</i>&nbsp;                Campaign oldCampaign = oldCampaignMap.get(campaign.Id);</b>
<b class="fc"><i>223</i>&nbsp;                if (campaign.RecordTypeId.equals(GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;DI_Campaign&#39;)) </b>
<b class="fc"><i>224</i>&nbsp;                    &amp;&amp; !campaign.IsActive &amp;&amp; oldCampaign.IsActive)</b>
<b class="fc"><i>225</i>&nbsp;                    campaignIdList.add(campaign.Id);</b>
<i>226</i>&nbsp;            }
<i>227</i>&nbsp;
<b class="fc"><i>228</i>&nbsp;            Campaign[] sessionList = [SELECT Id, IsActive FROM Campaign</b>
<b class="fc"><i>229</i>&nbsp;                                                            WHERE RecordTypeId = :GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;DI_Campaign_Session&#39;)</b>
<b class="fc"><i>230</i>&nbsp;                                                            AND Parent_Event__c IN :campaignIdList];</b>
<i>231</i>&nbsp;
<b class="fc"><i>232</i>&nbsp;            for (Campaign session : sessionList)</b>
<b class="fc"><i>233</i>&nbsp;                session.IsActive = false;</b>
<i>234</i>&nbsp;
<b class="fc"><i>235</i>&nbsp;            try {</b>
<b class="fc"><i>236</i>&nbsp;                if(!sessionList.isEmpty()){</b>
<b class="fc"><i>237</i>&nbsp;                     update sessionList;</b>
<i>238</i>&nbsp;                }
<b class="nc"><i>239</i>&nbsp;            } catch (DmlException e) {</b>
<b class="nc"><i>240</i>&nbsp;                    DebugLog.addException(e, &#39;deactivateCampaignSessions&#39;); </b>
<i>241</i>&nbsp;            }
<i>242</i>&nbsp;        }
<i>243</i>&nbsp;    }
<i>244</i>&nbsp;    /*------------------------------------------------------------
<i>245</i>&nbsp;    Description:    Method migrated from  CampMgmtCampaignSharingTrigger
<i>246</i>&nbsp;
<i>247</i>&nbsp;    Inputs:         @param newCampaignMap, oldCampaignMap
<i>248</i>&nbsp;    ------------------------------------------------------------*/
<b class="fc"><i>249</i>&nbsp;    public  static void campaignSharing(Map&lt;Id, Campaign&gt; newCampaignMap, Map&lt;Id, Campaign&gt; oldCampaignMap) {</b>
<b class="fc"><i>250</i>&nbsp;        BatchSettings__c settings = BatchSettings__c.getInstance(&#39;Default&#39;);</b>
<b class="fc"><i>251</i>&nbsp;        if (Test.isRunningTest() || settings.CampMgmtCampaignSharingTriggerIsEnabled__c){</b>
<b class="fc"><i>252</i>&nbsp;            List&lt;CampaignShare&gt; sharesUpsert = new List&lt;CampaignShare&gt;();</b>
<b class="fc"><i>253</i>&nbsp;            List&lt;CampaignShare&gt; sharesDelete = new List&lt;CampaignShare&gt;();</b>
<b class="fc"><i>254</i>&nbsp;            List&lt;Id&gt; campaignsIds =  new List&lt;Id&gt;();</b>
<i>255</i>&nbsp;
<b class="fc"><i>256</i>&nbsp;            for (Campaign newCampaign : newCampaignMap.values()) {</b>
<b class="fc"><i>257</i>&nbsp;                if (newCampaign.RecordTypeId.equals(GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;DI_Campaign&#39;))) {</b>
<b class="fc"><i>258</i>&nbsp;                    Boolean approverHasChanged = false;</b>
<b class="fc"><i>259</i>&nbsp;                    if (Trigger.isUpdate) {</b>
<b class="fc"><i>260</i>&nbsp;                        Campaign oldCampaign = newCampaignMap.get(newCampaign.Id);</b>
<b class="fc"><i>261</i>&nbsp;                        if (oldCampaign != null &amp;&amp; oldCampaign.Campaign_Approver__c != newCampaign.Campaign_Approver__c)</b>
<b class="nc"><i>262</i>&nbsp;                            approverHasChanged = true;</b>
<i>263</i>&nbsp;
<b class="fc"><i>264</i>&nbsp;                        if (approverHasChanged) {</b>
<b class="nc"><i>265</i>&nbsp;                            campaignsIds.add(oldCampaign.Id);</b>
<i>266</i>&nbsp;                        }
<i>267</i>&nbsp;                    }
<i>268</i>&nbsp;
<b class="fc"><i>269</i>&nbsp;                    if (Trigger.isInsert || approverHasChanged) {</b>
<b class="fc"><i>270</i>&nbsp;                        if (newCampaign.Campaign_Approver__c != null &amp;&amp; (newCampaign.Campaign_Approver__c &lt;&gt; newCampaign.OwnerId)) {</b>
<b class="nc"><i>271</i>&nbsp;                            CampaignShare share = new CampaignShare();</b>
<b class="nc"><i>272</i>&nbsp;                            share.CampaignId = newCampaign.Id;</b>
<b class="nc"><i>273</i>&nbsp;                            share.UserOrGroupId = newCampaign.Campaign_Approver__c;</b>
<b class="nc"><i>274</i>&nbsp;                            share.CampaignAccessLevel = &#39;Edit&#39;;</b>
<b class="nc"><i>275</i>&nbsp;                            sharesUpsert.add(share);</b>
<i>276</i>&nbsp;                        }
<i>277</i>&nbsp;                    }
<i>278</i>&nbsp;                }
<i>279</i>&nbsp;            }
<b class="fc"><i>280</i>&nbsp;            List&lt;CampaignShare&gt; oldShareList = [SELECT Id FROM CampaignShare WHERE CampaignId IN :campaignsIds AND RowCause = :Schema.CampaignShare.RowCause.Manual];</b>
<b class="fc"><i>281</i>&nbsp;            for (CampaignShare oldShare : oldShareList) {</b>
<b class="nc"><i>282</i>&nbsp;                if(oldShare.UserOrGroupId == oldCampaignMap.get(oldShare.Id).Campaign_Approver__c){</b>
<b class="nc"><i>283</i>&nbsp;                         sharesDelete.add(oldShare);</b>
<i>284</i>&nbsp;                }
<i>285</i>&nbsp;            }
<b class="fc"><i>286</i>&nbsp;            try {</b>
<b class="fc"><i>287</i>&nbsp;                if(!sharesDelete.isEmpty()){</b>
<b class="nc"><i>288</i>&nbsp;                     delete sharesDelete;</b>
<i>289</i>&nbsp;                }
<b class="fc"><i>290</i>&nbsp;                if(!sharesUpsert.isEmpty()){</b>
<b class="nc"><i>291</i>&nbsp;                    upsert sharesUpsert;</b>
<i>292</i>&nbsp;               }
<b class="nc"><i>293</i>&nbsp;            } catch (DmlException e) {</b>
<b class="nc"><i>294</i>&nbsp;                    DebugLog.addException(e, &#39;campaignSharing&#39;); </b>
<i>295</i>&nbsp;            }
<i>296</i>&nbsp;        }
<i>297</i>&nbsp;    }
<b class="fc"><i>298</i>&nbsp;    private static CampaignMemberStatus returnCampaignMemberStatus(ID campaignId, String label, Integer sortOrder, Boolean isDefault, Boolean hasResponded) {</b>
<b class="fc"><i>299</i>&nbsp;        return new CampaignMemberStatus(CampaignId = campaignId,</b>
<b class="fc"><i>300</i>&nbsp;                                        Label = label,</b>
<b class="fc"><i>301</i>&nbsp;                                        SortOrder = sortOrder,</b>
<b class="fc"><i>302</i>&nbsp;                                        IsDefault = isDefault,</b>
<b class="fc"><i>303</i>&nbsp;                                        HasResponded = hasResponded);</b>
<i>304</i>&nbsp;    }
<i>305</i>&nbsp;
<i>306</i>&nbsp;    /* keeping country fields aligned before update and before insert*/
<i>307</i>&nbsp;
<b class="fc"><i>308</i>&nbsp;    public static void setAlignmentOnCountryFields(List&lt;Campaign&gt; newCampaignList,Map&lt;Id, Campaign&gt; newCampaignMap, Map&lt;Id, Campaign&gt; oldCampaignMap){</b>
<b class="fc"><i>309</i>&nbsp;        Map&lt;String, CountryCodeMap__mdt&gt; countryNameMapping = new Map&lt;String, CountryCodeMap__mdt&gt;();</b>
<b class="fc"><i>310</i>&nbsp;        Map&lt;String, CountryCodeMap__mdt&gt; countryCodeMapping = new Map&lt;String, CountryCodeMap__mdt&gt;();</b>
<b class="fc"><i>311</i>&nbsp;        List&lt;CountryCodeMap__mdt&gt; countryList = [SELECT Campaign_Country__c, Country_Code_3_digit__c FROM CountryCodeMap__mdt];</b>
<b class="fc"><i>312</i>&nbsp;        for (CountryCodeMap__mdt country : countryList) {</b>
<b class="fc"><i>313</i>&nbsp;            countryNameMapping.put(country.Campaign_Country__c, country);</b>
<b class="fc"><i>314</i>&nbsp;            countryCodeMapping.put(country.Country_Code_3_digit__c, country);</b>
<i>315</i>&nbsp;        }
<b class="fc"><i>316</i>&nbsp;        if(newCampaignMap == null){</b>
<i>317</i>&nbsp;            /*when it is before insert*/
<b class="fc"><i>318</i>&nbsp;            for (Campaign newCampaign : newCampaignList) {</b>
<b class="fc"><i>319</i>&nbsp;            if (</b>
<b class="fc"><i>320</i>&nbsp;                String.isBlank(newCampaign.Campaign_Country__c)</b>
<i>321</i>&nbsp;                &amp;&amp; 
<b class="fc"><i>322</i>&nbsp;                String.isBlank(newCampaign.Country_Code_3_digit__c)</b>
<i>323</i>&nbsp;            ) {
<b class="fc"><i>324</i>&nbsp;                continue;</b>
<i>325</i>&nbsp;            }
<b class="fc"><i>326</i>&nbsp;            if (String.isNotBlank(newCampaign.Campaign_Country__c)) {</b>
<i>327</i>&nbsp;                // TODO: Update the other country field with the new value
<b class="fc"><i>328</i>&nbsp;                    newCampaign.Country_Code_3_digit__c = countryNameMapping.get(newCampaign.Campaign_Country__c).Country_Code_3_digit__c;</b>
<b class="fc"><i>329</i>&nbsp;            } else if (String.isNotBlank(newCampaign.Country_Code_3_digit__c)) {</b>
<i>330</i>&nbsp;                // TODO: Update the other country field with the new value
<b class="fc"><i>331</i>&nbsp;                newCampaign.Campaign_Country__c = countryCodeMapping.get(newCampaign.Country_Code_3_digit__c).Campaign_Country__c;</b>
<i>332</i>&nbsp;            }
<i>333</i>&nbsp;        }
<i>334</i>&nbsp;        } else {
<i>335</i>&nbsp;            /*when it is before update*/
<b class="fc"><i>336</i>&nbsp;            for (Campaign newCampaign : newCampaignMap.values()) {</b>
<b class="fc"><i>337</i>&nbsp;            if (</b>
<b class="fc"><i>338</i>&nbsp;                newCampaign.Campaign_Country__c == oldCampaignMap.get(newCampaign.Id).Campaign_Country__c</b>
<b class="fc"><i>339</i>&nbsp;                &amp;&amp; newCampaign.Country_Code_3_digit__c == oldCampaignMap.get(newCampaign.Id).Country_Code_3_digit__c</b>
<i>340</i>&nbsp;            ) {
<b class="fc"><i>341</i>&nbsp;                continue;</b>
<i>342</i>&nbsp;            }
<b class="fc"><i>343</i>&nbsp;            if (newCampaign.Campaign_Country__c != oldCampaignMap.get(newCampaign.Id).Campaign_Country__c) {</b>
<i>344</i>&nbsp;                // TODO: Update the other country field with the new value
<b class="fc"><i>345</i>&nbsp;                if (String.isBlank(newCampaign.Campaign_Country__c)) {</b>
<b class="nc"><i>346</i>&nbsp;                    newCampaign.Country_Code_3_digit__c = null;</b>
<i>347</i>&nbsp;                } else {
<b class="fc"><i>348</i>&nbsp;                    newCampaign.Country_Code_3_digit__c = countryNameMapping.get(newCampaign.Campaign_Country__c).Country_Code_3_digit__c;</b>
<i>349</i>&nbsp;                }
<b class="fc"><i>350</i>&nbsp;            } else if (newCampaign.Country_Code_3_digit__c != oldCampaignMap.get(newCampaign.Id).Country_Code_3_digit__c) {</b>
<i>351</i>&nbsp;                // TODO: Update the other country field with the new value
<b class="fc"><i>352</i>&nbsp;                if (String.isBlank(newCampaign.Country_Code_3_digit__c)) {</b>
<b class="nc"><i>353</i>&nbsp;                    newCampaign.Campaign_Country__c = null;</b>
<i>354</i>&nbsp;                } else {
<b class="fc"><i>355</i>&nbsp;                    newCampaign.Campaign_Country__c = countryCodeMapping.get(newCampaign.Country_Code_3_digit__c).Campaign_Country__c;</b>
<i>356</i>&nbsp;                }
<i>357</i>&nbsp;            }
<i>358</i>&nbsp;        }
<i>359</i>&nbsp;        }
<i>360</i>&nbsp;    }
<i>361</i>&nbsp;
<i>362</i>&nbsp;    //set default owner
<b class="fc"><i>363</i>&nbsp;    public static void ownerAssignment(List&lt;Campaign&gt; newCampaignList){</b>
<b class="fc"><i>364</i>&nbsp;        String eloquaIntegrationUser = &#39;Eloqua Integration&#39;;</b>
<b class="fc"><i>365</i>&nbsp;        String currentUser = UserInfo.getName();</b>
<b class="fc"><i>366</i>&nbsp;        String eloquaIntegrationUserId = UserInfo.getName() == eloquaIntegrationUser ? UserInfo.getUserId() : null;</b>
<b class="fc"><i>367</i>&nbsp;        if(currentUser == eloquaIntegrationUser) {</b>
<i>368</i>&nbsp;
<i>369</i>&nbsp;            
<b class="nc"><i>370</i>&nbsp;            Set&lt;String&gt; countriesSet2Digit = new Set&lt;String&gt;();</b>
<b class="nc"><i>371</i>&nbsp;            Map&lt;String, CountryCodeMap__mdt&gt; countryCode3DigitKeyMap = new Map&lt;String, CountryCodeMap__mdt&gt;();</b>
<b class="nc"><i>372</i>&nbsp;            List&lt;CountryCodeMap__mdt&gt; countryCodeMetadta = [SELECT Country_Code_2_digit__c, Country_Code_3_digit__c FROM CountryCodeMap__mdt];</b>
<b class="nc"><i>373</i>&nbsp;            for (CountryCodeMap__mdt country : countryCodeMetadta) {</b>
<b class="nc"><i>374</i>&nbsp;                countryCode3DigitKeyMap.put(country.Country_Code_3_digit__c, country);</b>
<i>375</i>&nbsp;            }
<b class="nc"><i>376</i>&nbsp;            for(Campaign camp : newCampaignList){</b>
<b class="nc"><i>377</i>&nbsp;                if(countryCode3DigitKeyMap.get(camp.Country_Code_3_digit__c) != null)</b>
<i>378</i>&nbsp;                {
<b class="nc"><i>379</i>&nbsp;                    countriesSet2Digit.add(countryCode3DigitKeyMap.get(camp.Country_Code_3_digit__c).Country_Code_2_digit__c);</b>
<i>380</i>&nbsp;                }
<i>381</i>&nbsp;            }
<i>382</i>&nbsp;
<b class="nc"><i>383</i>&nbsp;            if(!countriesSet2Digit.isEmpty())</b>
<i>384</i>&nbsp;            {
<b class="nc"><i>385</i>&nbsp;                LeadOpportunitySetting__mdt[] oppSettings = GlobalUtils.getOpportunitySettings(countriesSet2Digit);</b>
<i>386</i>&nbsp;
<b class="nc"><i>387</i>&nbsp;                Map&lt;String, LeadOpportunitySetting__mdt&gt; settingsMap = GlobalUtils.getSettingsMapWithNumberSignKey(oppSettings);</b>
<i>388</i>&nbsp;
<b class="nc"><i>389</i>&nbsp;                String digitalId = GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;Digital_Marketing_Campaign&#39;);</b>
<i>390</i>&nbsp;
<b class="nc"><i>391</i>&nbsp;                for(Campaign camp : newCampaignList)</b>
<b class="nc"><i>392</i>&nbsp;                {</b>
<b class="nc"><i>393</i>&nbsp;                    if(camp.recordTypeId == digitalId</b>
<b class="nc"><i>394</i>&nbsp;                            &amp;&amp; currentUser == eloquaIntegrationUser &amp;&amp; ((System.Trigger.isInsert == true ) || (camp.OwnerId == eloquaIntegrationUserId &amp;&amp; System.Trigger.isInsert == false ))){</b>
<b class="nc"><i>395</i>&nbsp;                        camp.OwnerId = settingsMap.get(countryCode3DigitKeyMap.get(camp.Country_Code_3_digit__c).Country_Code_2_digit__c+&#39;#&#39;+camp.Brands__c) != null &amp;&amp; settingsMap.get(countryCode3DigitKeyMap.get(camp.Country_Code_3_digit__c).Country_Code_2_digit__c+&#39;#&#39;+camp.Brands__c).DefaultCampaignOwner__c != null ? settingsMap.get(countryCode3DigitKeyMap.get(camp.Country_Code_3_digit__c).Country_Code_2_digit__c+&#39;#&#39;+camp.Brands__c).DefaultCampaignOwner__c : settingsMap.get(countryCode3DigitKeyMap.get(camp.Country_Code_3_digit__c).Country_Code_2_digit__c+&#39;#DefaultCountryOwner&#39;).DefaultCampaignOwner__c;</b>
<i>396</i>&nbsp;                    }
<i>397</i>&nbsp;                }
<i>398</i>&nbsp;            }
<i>399</i>&nbsp;        }
<i>400</i>&nbsp;    }
<i>401</i>&nbsp;
<i>402</i>&nbsp;    /**
<i>403</i>&nbsp;     * Process new Cvent Session campaigns inserted
<i>404</i>&nbsp;     * @author hadib@salesforce.com | 05-07-2023
<i>405</i>&nbsp;     * @param newCampaigns New Campaigns
<i>406</i>&nbsp;     */
<b class="fc"><i>407</i>&nbsp;    public static void processCventSessionCampaign(List&lt;Campaign&gt; newCampaigns)</b>
<i>408</i>&nbsp;    {
<i>409</i>&nbsp;        // Assort CVENT Session Campaigns in a map
<b class="fc"><i>410</i>&nbsp;        Map&lt;String,List&lt;Campaign&gt;&gt; sessionCampaignsByEventStub = new Map&lt;String, List&lt;Campaign&gt;&gt;();</b>
<b class="fc"><i>411</i>&nbsp;        String eventStub;</b>
<b class="fc"><i>412</i>&nbsp;        for (Campaign campaign : newCampaigns)</b>
<b class="fc"><i>413</i>&nbsp;        {</b>
<b class="fc"><i>414</i>&nbsp;            if(campaign.CventEvents__EventStub__c != null) // Main filter to detect session campaigns</b>
<i>415</i>&nbsp;            {
<b class="fc"><i>416</i>&nbsp;                eventStub = campaign.CventEvents__EventStub__c;</b>
<b class="fc"><i>417</i>&nbsp;                if(sessionCampaignsByEventStub.containsKey(eventStub))</b>
<i>418</i>&nbsp;                {
<b class="fc"><i>419</i>&nbsp;                    sessionCampaignsByEventStub.get(eventStub).add(campaign);</b>
<i>420</i>&nbsp;                }
<i>421</i>&nbsp;                else
<i>422</i>&nbsp;                {
<b class="fc"><i>423</i>&nbsp;                    sessionCampaignsByEventStub.put(eventStub, new List&lt;Campaign&gt;{campaign});</b>
<i>424</i>&nbsp;                }
<i>425</i>&nbsp;            }
<i>426</i>&nbsp;        }
<i>427</i>&nbsp;
<i>428</i>&nbsp;        // If we find CVENT Session Campaigns campaign we populate their parent campaign
<b class="fc"><i>429</i>&nbsp;        if (!sessionCampaignsByEventStub.isEmpty())</b>
<i>430</i>&nbsp;        {
<b class="fc"><i>431</i>&nbsp;            populateChildSessionCampaignFields(sessionCampaignsByEventStub);</b>
<i>432</i>&nbsp;        }
<i>433</i>&nbsp;    }
<i>434</i>&nbsp;
<i>435</i>&nbsp;    /**
<i>436</i>&nbsp;     * Populates the parent field for the session campaign records newly inserted
<i>437</i>&nbsp;     * @author hadib@salesforce.com | 05-07-2023
<i>438</i>&nbsp;     * @param sessionCampaignsByEventStub Session Campaign Map
<i>439</i>&nbsp;     */
<b class="fc"><i>440</i>&nbsp;    public static void populateChildSessionCampaignFields(Map&lt;String, List&lt;Campaign&gt;&gt; sessionCampaignsByEventStub)</b>
<i>441</i>&nbsp;    {
<b class="fc"><i>442</i>&nbsp;        Id sessionCampaignRTId = GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;CVENT_Session_Campaign&#39;);</b>
<b class="fc"><i>443</i>&nbsp;        Id memberRecordTypeId  = GlobalUtils.getRecordTypeId(&#39;CampaignMember&#39;, &#39;CVENT_Session_Campaign_Member&#39;);</b>
<i>444</i>&nbsp;
<b class="fc"><i>445</i>&nbsp;        Map&lt;String, Id&gt; mapEventStubToParentCampaign = new Map&lt;String, Id&gt;();</b>
<i>446</i>&nbsp;
<b class="fc"><i>447</i>&nbsp;        CventEvents__EventCampaignEntry__c[] entries = [</b>
<i>448</i>&nbsp;                SELECT Id, CventEvents__Campaign__c, CventEvents__Event__r.CventEvents__pkg_EventStub__c
<i>449</i>&nbsp;                FROM CventEvents__EventCampaignEntry__c
<b class="fc"><i>450</i>&nbsp;                WHERE CventEvents__Event__r.CventEvents__pkg_EventStub__c IN :sessionCampaignsByEventStub.keySet()</b>
<i>451</i>&nbsp;        ];
<i>452</i>&nbsp;
<b class="fc"><i>453</i>&nbsp;        for (CventEvents__EventCampaignEntry__c entry : entries) {</b>
<b class="fc"><i>454</i>&nbsp;            mapEventStubToParentCampaign.put(entry.CventEvents__Event__r.CventEvents__pkg_EventStub__c, entry.CventEvents__Campaign__c);</b>
<i>455</i>&nbsp;        }
<i>456</i>&nbsp;
<b class="fc"><i>457</i>&nbsp;        for (String eventStubValue : sessionCampaignsByEventStub.keySet()) {</b>
<b class="fc"><i>458</i>&nbsp;            for (Campaign campaign : sessionCampaignsByEventStub.get(eventStubValue)) {</b>
<b class="fc"><i>459</i>&nbsp;                campaign.Parent_Event__c = mapEventStubToParentCampaign.get(eventStubValue);</b>
<b class="fc"><i>460</i>&nbsp;                campaign.RecordTypeId = sessionCampaignRTId;</b>
<b class="fc"><i>461</i>&nbsp;                campaign.CampaignMemberRecordTypeId = memberRecordTypeId;</b>
<i>462</i>&nbsp;            }
<i>463</i>&nbsp;        }
<i>464</i>&nbsp;    }
<i>465</i>&nbsp;
<i>466</i>&nbsp;    /**
<i>467</i>&nbsp;     * Marks the Parent CVENT event record as non converted if the related campaign is being deleted
<i>468</i>&nbsp;     * @author hadib@salesforce.com | 01-11-2023
<i>469</i>&nbsp;     * @param oldCampaignList List of old values of the deleted campaign records
<i>470</i>&nbsp;     */
<b class="fc"><i>471</i>&nbsp;    public static void tickCventParentEventAsNotConverted(List&lt;Campaign&gt; oldCampaignList)</b>
<i>472</i>&nbsp;    {
<b class="fc"><i>473</i>&nbsp;        Set&lt;Id&gt; deletedCampaignIds = new Set&lt;Id&gt;();</b>
<i>474</i>&nbsp;
<b class="fc"><i>475</i>&nbsp;        for (Campaign deletedCampaign : oldCampaignList) {</b>
<b class="fc"><i>476</i>&nbsp;            deletedCampaignIds.add(deletedCampaign.Id);</b>
<i>477</i>&nbsp;        }
<i>478</i>&nbsp;
<i>479</i>&nbsp;        // Call the method to unconvert events related to the deleted campaigns
<b class="fc"><i>480</i>&nbsp;        List&lt;CventEvents__EventCampaignEntry__c&gt; deletedEntries =</b>
<b class="fc"><i>481</i>&nbsp;            [SELECT Id, CventEvents__Event__c</b>
<i>482</i>&nbsp;            FROM CventEvents__EventCampaignEntry__c
<b class="fc"><i>483</i>&nbsp;            WHERE CventEvents__Campaign__c IN :deletedCampaignIds];</b>
<i>484</i>&nbsp;
<b class="fc"><i>485</i>&nbsp;        CventManagement.tickParentEventAs(deletedEntries,false);</b>
<i>486</i>&nbsp;    }
<i>487</i>&nbsp;
<i>488</i>&nbsp;    /**
<i>489</i>&nbsp;     * Deletes Child CVENT Session Campaigns related to a parent Cvent Campaign.
<i>490</i>&nbsp;     * @author hadib@salesforce.com | 31-01-2024
<i>491</i>&nbsp;     * @param oldCampaignList List of the deleted campaign records
<i>492</i>&nbsp;     */
<b class="fc"><i>493</i>&nbsp;    public static void deleteChildSessionCampaigns(List&lt;Campaign&gt; oldCampaignList)</b>
<i>494</i>&nbsp;    {
<b class="fc"><i>495</i>&nbsp;        Id CventCampaignRTId = GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;CventCampaign&#39;);</b>
<b class="fc"><i>496</i>&nbsp;        Id sessionCampaignRTId = GlobalUtils.getRecordTypeId(&#39;Campaign&#39;, &#39;CVENT_Session_Campaign&#39;);</b>
<i>497</i>&nbsp;
<b class="fc"><i>498</i>&nbsp;        Set&lt;Id&gt; cventCampaignsDeleted = new Set&lt;Id&gt;();</b>
<i>499</i>&nbsp;
<b class="fc"><i>500</i>&nbsp;        for (Campaign deletedCampaign : oldCampaignList)</b>
<b class="fc"><i>501</i>&nbsp;        {</b>
<b class="fc"><i>502</i>&nbsp;            if(deletedCampaign.RecordTypeId == CventCampaignRTId) // Main Filter to find Cvent Campaigns</b>
<i>503</i>&nbsp;            {
<b class="fc"><i>504</i>&nbsp;                cventCampaignsDeleted.add(deletedCampaign.Id);</b>
<i>505</i>&nbsp;            }
<i>506</i>&nbsp;        }
<i>507</i>&nbsp;
<b class="fc"><i>508</i>&nbsp;        List&lt;Campaign&gt; childCventSessionCampaigns = [SELECT Id FROM Campaign WHERE Parent_Event__c IN :cventCampaignsDeleted AND RecordTypeId = :sessionCampaignRTId];</b>
<i>509</i>&nbsp;
<b class="fc"><i>510</i>&nbsp;        try{</b>
<b class="fc"><i>511</i>&nbsp;            delete ChildCventSessionCampaigns;</b>
<b class="nc"><i>512</i>&nbsp;        }catch(Exception exc) {</b>
<b class="nc"><i>513</i>&nbsp;            DebugLog.addException(exc, &#39;Unable to delete Child Session Campaigns&#39;);</b>
<i>514</i>&nbsp;        }
<i>515</i>&nbsp;    }
<i>516</i>&nbsp;
<i>517</i>&nbsp;
<i>518</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2024-12-10 16:19</div>
</div>
</body>
</html>
